<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgriGuard - Disease Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0c0a09; /* Stone-950 */
            color: #d6d3d1; /* Stone-300 */
            overflow: hidden; /* Hide scrollbar during animation */
        }
        .gradient-bg {
            background-image: linear-gradient(to right, #00b09b, #96c93d);
        }
        .card-bg {
            background-color: #1c1917; /* Stone-900 */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        .card-bg:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .btn-primary {
            background-color: #00b09b;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .btn-primary:hover {
            background-color: #009688;
            transform: translateY(-1px);
        }
        .input-style {
            background-color: #292524; /* Stone-800 */
            border: 1px solid #44403c; /* Stone-700 */
            color: #d6d3d1;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .input-style:focus {
            border-color: #10b981; /* Green-500 */
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.5);
        }
        .badge {
            font-weight: 500;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }

        /* Card Fade-in Animation */
        @keyframes cardFadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .card-animate {
            animation: cardFadeInUp 0.6s ease-out forwards;
        }
        .card-animate:nth-child(1) { animation-delay: 0.1s; }
        .card-animate:nth-child(2) { animation-delay: 0.2s; }
        .card-animate:nth-child(3) { animation-delay: 0.3s; }
        .card-animate:nth-child(4) { animation-delay: 0.4s; }
        .card-animate:nth-child(5) { animation-delay: 0.5s; }
        .card-animate:nth-child(6) { animation-delay: 0.6s; }
        .card-animate:nth-child(7) { animation-delay: 0.7s; }
        .card-animate:nth-child(8) { animation-delay: 0.8s; }
        .page { display: none; }
        .page.active { display: block; }
        .nav-link.active {
            color: #10b981; /* Green-500 */
            border-bottom: 2px solid #10b981;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #1c1917;
            margin: 5% auto;
            padding: 24px;
            border: 1px solid #44403c;
            width: 90%;
            max-width: 700px;
            border-radius: 1rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .close-btn {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            color: #d6d3d1;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .close-btn:hover, .close-btn:focus {
            color: #fca5a5;
        }

        /* New pre-loader and animation styles */
        #pre-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #0c0a09;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .pre-loader-logo {
            animation: rotate 1.5s linear infinite;
        }
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        .fade-out {
            opacity: 0;
            visibility: hidden;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div id="pre-loader">
        <svg class="pre-loader-logo h-24 w-24 text-green-500" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2C8.68629 2 6 4.68629 6 8C6 11.3137 8.68629 14 12 14C15.3137 14 18 11.3137 18 8C18 4.68629 15.3137 2 12 2Z" fill="currentColor"/>
            <path d="M12 14C8.68629 14 6 16.6863 6 20C6 23.3137 8.68629 26 12 26C15.3137 26 18 23.3137 18 20C18 16.6863 15.3137 14 12 14Z" fill="currentColor"/>
            <path d="M12 26V30" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M16 20C16 18.3431 14.6569 17 13 17C11.3431 17 10 18.3431 10 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <p class="text-white text-xl mt-4">Loading AgriGuard...</p>
    </div>

    <header class="w-full text-white py-4 px-6 md:px-12 flex justify-between items-center bg-gray-900 shadow-lg">
        <div class="flex items-center space-x-2">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-green-500">
                <path d="M12 2C8.68629 2 6 4.68629 6 8C6 11.3137 8.68629 14 12 14C15.3137 14 18 11.3137 18 8C18 4.68629 15.3137 2 12 2Z" fill="currentColor"/>
                <path d="M12 14C8.68629 14 6 16.6863 6 20C6 23.3137 8.68629 26 12 26C15.3137 26 18 23.3137 18 20C18 16.6863 15.3137 14 12 14Z" fill="currentColor"/>
                <path d="M12 26V30" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M16 20C16 18.3431 14.6569 17 13 17C11.3431 17 10 18.3431 10 20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <h1 class="text-2xl font-bold tracking-tight text-white">AgriGuard</h1>
        </div>
        <nav class="hidden md:flex space-x-6">
            <a href="#home" class="nav-link hover:text-green-400 transition-colors duration-200">Home</a>
            <a href="#about" class="nav-link hover:text-green-400 transition-colors duration-200">About</a>
            <a href="#explorer" class="nav-link hover:text-green-400 transition-colors duration-200">Disease Explorer</a>
            <a href="#features" class="nav-link hover:text-green-400 transition-colors duration-200">Features</a>
            <a href="#contact" class="nav-link hover:text-green-400 transition-colors duration-200">Contact</a>
            <a href="#all-diseases" class="nav-link hover:text-green-400 transition-colors duration-200">All Diseases</a>
        </nav>
        <button class="md:hidden text-white focus:outline-none">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>
    </header>

    <main class="flex-grow">
        <section id="home-page" class="page text-center py-16 md:py-24 px-4 bg-gray-900 active">
            <h2 class="text-5xl md:text-6xl font-extrabold text-white tracking-tight mb-4">Welcome to AgriGuard</h2>
            <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto mb-8">
                Your centralized knowledge base for quick and reliable information on crop diseases.
                Empowering farmers with the knowledge they need to protect their crops and livelihoods.
            </p>
            <a href="#explorer" class="inline-block px-8 py-4 text-lg font-semibold text-white btn-primary rounded-xl hover:scale-105 transition-transform duration-200">
                Explore Diseases Now
            </a>
        </section>

        <section id="about-page" class="page py-16 md:py-24 px-4 bg-gray-900">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-center text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-8">About AgriGuard</h2>
                <p class="text-lg text-gray-400 leading-relaxed mb-6">
                    AgriGuard was created to bridge the knowledge gap between farmers and critical agricultural data. Our mission is to provide an accessible and easy-to-use platform where anyone can quickly identify and learn about crop diseases. By leveraging modern web technologies and AI, we aim to empower farmers with the information they need to protect their crops and ensure a successful harvest.
                </p>
            
            </div>
        </section>

        <section id="features-page" class="page py-16 md:py-24 px-4 bg-gray-900">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-center text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-8">Key Features</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 text-center">
                    <div class="card-bg rounded-2xl p-6 shadow-lg border border-gray-700 hover:scale-105 transition-transform duration-200">
                        <svg class="h-12 w-12 mx-auto text-green-400 mb-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5a6.5 6.5 0 1 0-6.5 6.5c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                        <h3 class="text-2xl font-bold mb-2 text-green-400">Interactive Explorer</h3>
                        <p class="text-gray-400">Easily search and filter through a comprehensive list of crop diseases to find what you're looking for instantly.</p>
                    </div>
                    <div class="card-bg rounded-2xl p-6 shadow-lg border border-gray-700 hover:scale-105 transition-transform duration-200">
                        <svg class="h-12 w-12 mx-auto text-green-400 mb-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                        </svg>
                        <h3 class="text-2xl font-bold mb-2 text-green-400">AI-Powered Tips</h3>
                        <p class="text-gray-400">Generate dynamic, up-to-date prevention and treatment tips for any disease using the power of Google's Gemini API.</p>
                    </div>
                    <div class="card-bg rounded-2xl p-6 shadow-lg border border-gray-700 hover:scale-105 transition-transform duration-200">
                        <svg class="h-12 w-12 mx-auto text-green-400 mb-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 3v18c4.97-1.49 8-6.03 8-11.5S16.97 4.49 12 3zm-6 0v18c-3.11-1.27-5-4.43-5-8.5s1.89-7.23 5-8.5z"/>
                        </svg>
                        <h3 class="text-2xl font-bold mb-2 text-green-400">Audio Accessibility</h3>
                        <p class="text-gray-400">Listen to the generated tips with our integrated text-to-speech functionality, making information accessible for everyone.</p>
                    </div>
                    <div class="card-bg rounded-2xl p-6 shadow-lg border border-gray-700 hover:scale-105 transition-transform duration-200">
                        <svg class="h-12 w-12 mx-auto text-green-400 mb-4" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
                        </svg>
                        <h3 class="text-2xl font-bold mb-2 text-green-400">Data Visualization</h3>
                        <p class="text-gray-400">Gain insights into disease distribution with a built-in chart that visually represents our knowledge base.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="explorer-page" class="page py-8 px-4 md:px-12 bg-gray-900">
            <h2 class="text-center text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-8">Disease Explorer</h2>
            <div class="flex flex-wrap items-center justify-center space-y-4 md:space-y-0 md:space-x-4">
                <input type="text" id="searchInput" placeholder="Search disease by name..." class="w-full md:w-auto flex-grow input-style rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" oninput="filterCards()">
                <select id="cropSelect" class="w-full md:w-48 input-style rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" onchange="filterCards()"></select>
                <select id="symptomSelect" class="w-full md:w-48 input-style rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" onchange="filterCards()"></select>
                <select id="categorySelect" class="w-full md:w-48 input-style rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" onchange="filterCards()"></select>
                <select id="severitySelect" class="w-full md:w-48 input-style rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" onchange="filterCards()"></select>
                <button class="w-full md:w-auto px-6 py-3 font-semibold text-white btn-primary rounded-xl hover:scale-105 transition-transform duration-200" onclick="resetFilters()">Reset</button>
            </div>
            <div id="explorerCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8 mt-8">
                </div>
        </section>

        <section id="all-diseases-page" class="page py-8 px-4 md:px-12 bg-gray-900">
            <h2 class="text-center text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-8">All Diseases</h2>
            <div id="allDiseasesChartContainer" class="max-w-4xl mx-auto mb-8">
                <canvas id="diseaseChart"></canvas>
            </div>
            <div id="allDiseasesCardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                </div>
        </section>
        
        <section id="contact-page" class="page py-16 md:py-24 px-4 bg-gray-900">
            <div class="max-w-2xl mx-auto text-center">
                <h2 class="text-4xl md:text-5xl font-extrabold text-white tracking-tight mb-8">Contact Us</h2>
                <p class="text-lg text-gray-400 mb-8">
                    Have questions or feedback? Feel free to reach out to us.
                </p>
                <div class="space-y-4">
                    <p class="text-xl font-semibold text-white">Email</p>
                    <a href="mailto:contact@agrigard.com" class="text-green-400 hover:underline">contact@agrigard.com</a>
                    <p class="text-xl font-semibold text-white mt-4">Phone</p>
                    <p class="text-lg text-gray-400">+1 (555) 123-4567</p>
                    <p class="text-xl font-semibold text-white mt-8">Address</p>
                    <p class="text-lg text-gray-400">123 Farmstead Lane, Agriland, CA 90210</p>
                    <p class="text-xl font-semibold text-white mt-8">Socials</p>
                    <div class="flex justify-center space-x-6 text-2xl">
                        <a href="#" class="text-gray-400 hover:text-green-400 transition-colors">Twitter</a>
                        <a href="#" class="text-gray-400 hover:text-green-400 transition-colors">LinkedIn</a>
                        <a href="#" class="text-gray-400 hover:text-green-400 transition-colors">GitHub</a>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="text-center text-gray-500 text-sm py-4 bg-gray-900 mt-auto">
        &copy; 2023 AgriGuard. All rights reserved.
    </footer>

    <div id="diseaseModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <h3 id="modalName" class="text-3xl font-bold mb-2 text-white"></h3>
            <p id="modalDescription" class="text-gray-400 mb-4"></p>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-300">
                <div>
                    <strong class="text-gray-500">Crop:</strong> <span id="modalCrop"></span>
                </div>
                <div>
                    <strong class="text-gray-500">Symptom:</strong> <span id="modalSymptom"></span>
                </div>
                <div>
                    <strong class="text-gray-500">Category:</strong> <span id="modalCategory"></span>
                </div>
                <div>
                    <strong class="text-gray-500">Severity:</strong> <span id="modalSeverity" class="badge"></span>
                </div>
                </div>
                <div id="modalRemedies" class="mt-8">
                    <h4 class="text-xl font-semibold mb-2 text-white">Prevention & Treatment</h4>
                    <div class="flex flex-col sm:flex-row sm:space-x-4 mb-4">
                        <button id="generateTipsBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors duration-200 mb-2 sm:mb-0">Generate AI Tips ✨</button>
                        <button id="listenTipsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">Listen 🎧</button>
                    </div>
                    <div id="loadingIndicator" class="hidden text-center text-gray-400 mb-4">
                        <svg class="animate-spin h-6 w-6 text-green-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2">Generating tips...</p>
                    </div>
                    <div id="remediesContent" class="space-y-4">
                        <p id="placeholderText" class="text-gray-500">Click "Generate AI Tips ✨" to get prevention and treatment tips from our AI.</p>
                        <ul id="remediesList" class="list-disc list-inside space-y-2 text-gray-300 hidden"></ul>
                    </div>
                </div>
            </div>
        </div>
    
        <script>
            // Define the dummy data
            const diseases = [
                { id: 1, name: 'Wheat Leaf Blight', description: 'A common fungal disease in wheat.', crop: 'Wheat', symptom: 'Leaf Spotting', category: 'Bacterial', severity: 'High' },
                { id: 2, name: 'Rice Blast', description: 'A major disease affecting rice crops globally.', crop: 'Rice', symptom: 'Leaf Blight', category: 'Fungal', severity: 'Medium' },
                { id: 3, name: 'Yellow Rust', description: 'Causes significant yield loss in wheat.', crop: 'Wheat', symptom: 'Leaf Blight', category: 'Fungal', severity: 'Low' },
                { id: 4, name: 'Brown Spot', description: 'Widespread fungal disease of rice.', crop: 'Rice', symptom: 'Leaf Spotting', category: 'Fungal', severity: 'High' },
                { id: 5, name: 'Potato Blight', description: 'A destructive disease that affects potato crops.', crop: 'Potato', symptom: 'Leaf Lesions', category: 'Oomycete', severity: 'High' },
                { id: 6, name: 'Corn Smut', description: 'Fungal disease that turns kernels into black galls.', crop: 'Corn', symptom: 'Galls', category: 'Fungal', severity: 'Medium' },
                { id: 7, name: 'Soybean Rust', description: 'Can cause severe defoliation and yield loss.', crop: 'Soybean', symptom: 'Brown Lesions', category: 'Fungal', severity: 'High' },
                { id: 8, name: 'Apple Scab', description: 'A worldwide fungal disease of apples.', crop: 'Apple', symptom: 'Leaf Spots', category: 'Fungal', severity: 'Low' },
                { id: 9, name: 'Grape Powdery Mildew', description: 'A fungal disease on grapes that looks like a white powder.', crop: 'Grape', symptom: 'Powdery Coating', category: 'Fungal', severity: 'Medium' },
                { id: 10, name: 'Tomato Leaf Mold', description: 'Causes yellow spots on tomato leaves.', crop: 'Tomato', symptom: 'Yellow Spots', category: 'Fungal', severity: 'Low' },
                { id: 11, name: 'Citrus Canker', description: 'A highly contagious bacterial disease of citrus.', crop: 'Citrus', symptom: 'Lesions', category: 'Bacterial', severity: 'High' },
                { id: 12, name: 'Cucumber Downy Mildew', description: 'Affects cucumbers with a downy, whitish mold.', crop: 'Cucumber', symptom: 'Whitish Mold', category: 'Oomycete', severity: 'Medium' }
            ];
    
            let currentDiseaseName = '';
            const apiKey = "AIzaSyADU3bz1gKCOBBB1TlhPYF57KvmP8epnlc";
            let audioContext = null;
    
            // Function to create a disease card HTML element
            function createDiseaseCard(disease, index) {
                const severityColor = {
                    'High': 'bg-red-600',
                    'Medium': 'bg-yellow-600',
                    'Low': 'bg-green-600'
                };
    
                return `
                    <div class="card-bg rounded-2xl p-6 shadow-lg border border-gray-700 card-animate" style="animation-delay: ${index * 0.1}s;" onclick="openModal(${disease.id})">
                        <h3 class="text-xl font-bold mb-2 text-white">${disease.name}</h3>
                        <p class="text-sm text-gray-400 mb-4">${disease.description}</p>
                        <div class="space-y-2 text-gray-300">
                            <p class="flex items-center"><strong class="w-20 font-medium text-gray-500">Crop:</strong> <span class="ml-2">${disease.crop}</span></p>
                            <p class="flex items-center"><strong class="w-20 font-medium text-gray-500">Symptom:</strong> <span class="ml-2">${disease.symptom}</span></p>
                            <p class="flex items-center"><strong class="w-20 font-medium text-gray-500">Category:</strong> <span class="ml-2">${disease.category}</span></p>
                            <p class="flex items-center"><strong class="w-20 font-medium text-gray-500">Severity:</strong> <span class="ml-2 ${severityColor[disease.severity]} text-white badge">${disease.severity}</span></p>
                        </div>
                    </div>
                `;
            }
    
            // Function to render disease cards
            function renderCards(filteredDiseases, containerId) {
                const container = document.getElementById(containerId);
                container.innerHTML = filteredDiseases.map((disease, index) => createDiseaseCard(disease, index)).join('');
            }
    
            // Function to populate a select menu with unique options
            function populateSelect(selectId, dataArray, placeholder) {
                const selectElement = document.getElementById(selectId);
                selectElement.innerHTML = `<option value="">${placeholder}</option>`;
                const uniqueOptions = [...new Set(dataArray)].sort();
                uniqueOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    selectElement.appendChild(optionElement);
                });
            }
    
            // Function to filter the cards based on select and input values
            function filterCards() {
                const searchQuery = document.getElementById('searchInput').value.toLowerCase();
                const cropFilter = document.getElementById('cropSelect').value;
                const symptomFilter = document.getElementById('symptomSelect').value;
                const categoryFilter = document.getElementById('categorySelect').value;
                const severityFilter = document.getElementById('severitySelect').value;
    
                const filtered = diseases.filter(disease => {
                    const matchesSearch = disease.name.toLowerCase().includes(searchQuery);
                    const matchesCrop = !cropFilter || disease.crop === cropFilter;
                    const matchesSymptom = !symptomFilter || disease.symptom === symptomFilter;
                    const matchesCategory = !categoryFilter || disease.category === categoryFilter;
                    const matchesSeverity = !severityFilter || disease.severity === severityFilter;
                    
                    return matchesSearch && matchesCrop && matchesSymptom && matchesCategory && matchesSeverity;
                });
                renderCards(filtered, 'explorerCardsContainer');
            }
    
            // Function to reset all filters
            function resetFilters() {
                document.getElementById('searchInput').value = '';
                document.getElementById('cropSelect').value = '';
                document.getElementById('symptomSelect').value = '';
                document.getElementById('categorySelect').value = '';
                document.getElementById('severitySelect').value = '';
                filterCards(); // Rerun the filter with reset values
            }
    
            // Navigation logic for the single-page app
            function showPage(pageId) {
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => page.classList.remove('active'));
    
                const navLinks = document.querySelectorAll('.nav-link');
                navLinks.forEach(link => link.classList.remove('active'));
                
                const activePage = document.getElementById(pageId);
                if (activePage) {
                    activePage.classList.add('active');
                }
    
                const activeLink = document.querySelector(`.nav-link[href="#${pageId.replace('-page', '')}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }
    
            function handleHashChange() {
                const hash = window.location.hash.substring(1);
                const pageId = hash ? `${hash}-page` : 'home-page';
                showPage(pageId);
            }
    
            // Modal Functions
            function openModal(diseaseId) {
                const disease = diseases.find(d => d.id === diseaseId);
                if (!disease) return;
    
                // Store the current disease name for the API call
                currentDiseaseName = disease.name;
    
                // Populate modal content
                document.getElementById('modalName').textContent = disease.name;
                document.getElementById('modalDescription').textContent = disease.description;
                document.getElementById('modalCrop').textContent = disease.crop;
                document.getElementById('modalSymptom').textContent = disease.symptom;
                document.getElementById('modalCategory').textContent = disease.category;
    
                const modalSeverity = document.getElementById('modalSeverity');
                modalSeverity.textContent = disease.severity;
                const severityColor = {
                    'High': 'bg-red-600',
                    'Medium': 'bg-yellow-600',
                    'Low': 'bg-green-600'
                };
                modalSeverity.className = `badge ${severityColor[disease.severity]}`;
    
                // Reset remedies content
                document.getElementById('placeholderText').classList.remove('hidden');
                document.getElementById('remediesList').classList.add('hidden');
                document.getElementById('remediesList').innerHTML = '';
                
                // Show the modal
                document.getElementById('diseaseModal').style.display = 'block';
            }
    
            function closeModal() {
                document.getElementById('diseaseModal').style.display = 'none';
            }
    
            // Close modal when clicking outside of it
            window.onclick = function(event) {
                const modal = document.getElementById('diseaseModal');
                if (event.target == modal) {
                    closeModal();
                }
            }
    
            // LLM Integration Functions
            document.getElementById('generateTipsBtn').addEventListener('click', generateAITips);
            document.getElementById('listenTipsBtn').addEventListener('click', playAudioRemedies);
    
            async function generateAITips() {
                const loadingIndicator = document.getElementById('loadingIndicator');
                const remediesList = document.getElementById('remediesList');
                const placeholderText = document.getElementById('placeholderText');
                
                loadingIndicator.classList.remove('hidden');
                placeholderText.classList.add('hidden');
                remediesList.innerHTML = '';
                remediesList.classList.add('hidden');
    
                const userQuery = `Provide detailed prevention and treatment tips for the crop disease "${currentDiseaseName}". Give me the output in a numbered list.`;
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                };
    
                let retries = 0;
                const maxRetries = 3;
                const delay = 1000;
    
                async function fetchDataWithRetry() {
                    try {
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        if (!response.ok) throw new Error('API request failed');
                        return await response.json();
                    } catch (error) {
                        if (retries < maxRetries) {
                            retries++;
                            await new Promise(res => setTimeout(res, delay * Math.pow(2, retries)));
                            return fetchDataWithRetry();
                        } else {
                            throw error;
                        }
                    }
                }
    
                try {
                    const result = await fetchDataWithRetry();
                    const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || 'No tips could be generated.';
                    const tips = text.split('\n').filter(tip => tip.trim() !== '');
                    
                    remediesList.innerHTML = tips.map(tip => `<li>${tip.replace(/^\d+\.\s*/, '')}</li>`).join('');
                    remediesList.classList.remove('hidden');
    
                } catch (error) {
                    remediesList.innerHTML = '<li>An error occurred while generating tips. Please try again.</li>';
                    remediesList.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            }
    
            async function playAudioRemedies() {
                const tipsText = document.getElementById('remediesList').innerText;
                if (!tipsText) {
                    alert('Please generate the tips first.');
                    return;
                }
    
                const audioUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
                
                const payload = {
                    contents: [{
                        parts: [{ text: `Here are the tips: ${tipsText}` }]
                    }],
                    generationConfig: {
                        responseModalities: ["AUDIO"],
                        speechConfig: {
                            voiceConfig: {
                                prebuiltVoiceConfig: { voiceName: "Puck" }
                            }
                        }
                    },
                };
    
                const response = await fetch(audioUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
    
                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;
    
                if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                    const sampleRate = parseInt(mimeType.match(/rate=(\d+)/)[1], 10);
                    const pcmData = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmData);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audio = new Audio(URL.createObjectURL(wavBlob));
                    audio.play();
                } else {
                    console.error('Audio data not found or invalid.');
                }
            }
    
            // Helper function to convert base64 to ArrayBuffer
            function base64ToArrayBuffer(base64) {
                const binaryString = window.atob(base64);
                const len = binaryString.length;
                const bytes = new Uint8Array(len);
                for (let i = 0; i < len; i++) {
                    bytes[i] = binaryString.charCodeAt(i);
                }
                return bytes.buffer;
            }
    
            // Helper function to convert PCM audio to WAV blob
            function pcmToWav(pcmData, sampleRate) {
                const numSamples = pcmData.length;
                const buffer = new ArrayBuffer(44 + numSamples * 2);
                const view = new DataView(buffer);
                
                let offset = 0;
                function writeString(str) {
                    for (let i = 0; i < str.length; i++) {
                        view.setUint8(offset++, str.charCodeAt(i));
                    }
                }
    
                writeString('RIFF');
                view.setUint32(offset, 36 + numSamples * 2, true);
                offset += 4;
                writeString('WAVE');
                writeString('fmt ');
                view.setUint32(offset, 16, true);
                offset += 4;
                view.setUint16(offset, 1, true);
                offset += 2;
                view.setUint16(offset, 1, true); // Mono
                offset += 2;
                view.setUint32(offset, sampleRate, true);
                offset += 4;
                view.setUint32(offset, sampleRate * 2, true);
                offset += 4;
                view.setUint16(offset, 2, true);
                offset += 2;
                view.setUint16(offset, 16, true);
                offset += 2;
                writeString('data');
                view.setUint32(offset, numSamples * 2, true);
                offset += 4;
    
                for (let i = 0; i < numSamples; i++) {
                    view.setInt16(offset, pcmData[i], true);
                    offset += 2;
                }
    
                return new Blob([view], { type: 'audio/wav' });
            }
    
    
            // Chart.js functions
            function renderChart() {
                const categories = diseases.map(d => d.category);
                const uniqueCategories = [...new Set(categories)];
                const dataCounts = uniqueCategories.map(cat => categories.filter(c => c === cat).length);
    
                const ctx = document.getElementById('diseaseChart').getContext('2d');
                const chart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: uniqueCategories,
                        datasets: [{
                            label: 'Number of Diseases',
                            data: dataCounts,
                            backgroundColor: [
                                'rgba(16, 185, 129, 0.8)', // green
                                'rgba(245, 158, 11, 0.8)', // yellow
                                'rgba(244, 63, 94, 0.8)', // red
                            ],
                            borderColor: [
                                'rgba(16, 185, 129, 1)',
                                'rgba(245, 158, 11, 1)',
                                'rgba(244, 63, 94, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    color: '#d6d3d1'
                                },
                                grid: {
                                    color: '#44403c'
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#d6d3d1'
                                },
                                grid: {
                                    display: false
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false,
                            },
                            title: {
                                display: true,
                                text: 'Disease Distribution by Category',
                                color: '#d6d3d1',
                                font: {
                                    size: 18,
                                    family: 'Inter'
                                }
                            }
                        }
                    }
                });
            }
    
            // Initialize the page on load
            document.addEventListener('DOMContentLoaded', () => {
                const crops = diseases.map(d => d.crop);
                const symptoms = diseases.map(d => d.symptom);
                const categories = diseases.map(d => d.category);
                const severities = diseases.map(d => d.severity);
    
                populateSelect('cropSelect', crops, 'Crop type');
                populateSelect('symptomSelect', symptoms, 'Symptom');
                populateSelect('categorySelect', categories, 'Category');
                populateSelect('severitySelect', severities, 'Severity');
    
                renderCards(diseases, 'explorerCardsContainer');
                renderCards(diseases, 'allDiseasesCardsContainer');
    
                window.addEventListener('hashchange', handleHashChange);
                handleHashChange(); // Call on initial load to set the correct page based on the URL hash
    
                // Ensure the chart renders only when the canvas element exists
                const allDiseasesPage = document.getElementById('all-diseases-page');
                const observer = new MutationObserver((mutationsList, observer) => {
                    if (allDiseasesPage.classList.contains('active')) {
                        renderChart();
                        observer.disconnect();
                    }
                });
                observer.observe(document.body, { attributes: true, subtree: true });

                // Remove the pre-loader after a short delay
                setTimeout(() => {
                    document.getElementById('pre-loader').classList.add('fade-out');
                    document.body.style.overflow = 'auto'; // Re-enable scrolling after animation
                }, 1500); // Adjust duration here (1.5 seconds)
            });
        </script>
    </body>
    </html>
